{% extends 'base.html' %}
{% load static %}

{% block title %}회원가입{% endblock title %}

{% block style %}
  <link rel="stylesheet" href="{% static 'accounts/css/signup.css' %}">
{% endblock style %}

{% block content %}
  <form action="{% url 'accounts:signup' %}" method="POST" enctype="multipart/form-data">
    {% csrf_token %}
    <div class="d-flex flex-column">
      <div class="d-flex flex-column mt-3" style="margin: auto;">
        <div class="signup--content">
          <label for="{{ form.username.id_for_label }}"><strong>사용자명 :</strong></label>
          {{ form.username }}
          <button type="button" id="check-username" value = "aaa">중복 확인</button>
          <div id="username-result"></div>
        </div>
      </div>
      <div class="d-flex flex-column mt-3" style="margin: auto;">
        <div class="signup--content">
          <label for="{{ form.first_name.id_for_label }}"><strong>이름 :</strong></label>
          {{ form.first_name }}
        </div>
      </div>
      <div class="d-flex flex-column mt-3" style="margin: auto;">
        <div class="signup--content">
          <label for="{{ form.birthday.id_for_label }}"><strong>생일 :</strong></label>
          {{ form.birthday }}
        </div>
      </div>
      <div class="d-flex flex-column mt-3" style="margin: auto;">
        <div class="signup--content">
          <label for="{{ form.email.id_for_label }}"><strong>이메일 :</strong></label>
          {{ form.email }}
        </div>
      </div>
      <div class="d-flex flex-column mt-3" style="margin: auto;">
        <div class="signup--content">
          <label for="{{ form.image.id_for_label }}"><strong>이미지 :</strong></label>
          {{ form.image }}
        </div>
      </div>
      <div class="d-flex flex-column mt-3" style="margin: auto;">
        <div class="signup--content">
          <label for="{{ form.password1.id_for_label }}"><strong>비밀번호 :</strong></label>
          {{ form.password1 }}
        </div>
      </div>
      <div class="d-flex flex-column mt-3" style="margin: auto;">
        <div class="signup--content">
          <label for="{{ form.password2.id_for_label }}"><strong>비밀번호 확인 :</strong></label>
          {{ form.password2 }}
        </div>
      </div>
      <div class="d-flex flex-column mt-3" style="margin: auto;">
        <div class="signup--content">
          <label for="{{ form.region.id_for_label }}"><strong>지역 :</strong></label>
          {{ form.region }}
        </div>
      </div>
      <div class="mt-3" style="margin: auto;">
        <div class="signup--content d-flex" style="padding: 6px 0;">
          <label for="{{ form.privacy.id_for_label }}"><strong>지역 공개 여부 :</strong></label>
          &nbsp;&nbsp;{{ form.privacy }}
        </div>
      </div>
      <div class="d-flex flex-column mt-3" style="margin: auto;">
        <div class="signup--content">
          <label for="{{ form.introductions.id_for_label }}"><strong>자기 소개 :</strong></label>
          {{ form.introductions }}
        </div>
      </div>
    </div>
    <div class="d-flex justify-content-center">
      <input class="signup--btn mt-3" type="submit" value="회원가입">
    </div>
  </form>
{% endblock content %}

{% block script %}
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const checkUsernameButton = document.getElementById('check-username');
    const usernameResult = document.getElementById('username-result');
    const csrfToken = document.querySelector('input[name="csrfmiddlewaretoken"]').value; // csrf 토큰 가져오기
  
    checkUsernameButton.addEventListener('click', function () {
      const usernameInput = document.getElementById('id_username');
      const username = usernameInput.value.trim();
  
      if (username !== '') {
        // AJAX 요청
        const xhr = new XMLHttpRequest();
        xhr.open('POST', '{% url 'accounts:check_username' %}');
        xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
        xhr.setRequestHeader('X-CSRFToken', csrfToken); // csrf 토큰 헤더에 추가
        xhr.onload = function () {
          if (xhr.status === 200) {
            const response = JSON.parse(xhr.responseText);
            if (response.available) {
              usernameResult.textContent = '사용 가능한 아이디입니다.';
            } else {
              usernameResult.textContent = '이미 사용 중인 아이디입니다.';
            }
          }
        };
        xhr.send('username=' + encodeURIComponent(username));
      }
    });
  });
</script>
{% endblock script %}
